# Prediction Market ç³»ç»Ÿæ¶æ„ç†è§£æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª **é«˜æ€§èƒ½é¢„æµ‹å¸‚åœºæ’®åˆå¼•æ“ç³»ç»Ÿ**ï¼Œä½¿ç”¨ Rust ç¼–å†™ï¼Œé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ã€‚ç³»ç»Ÿæ”¯æŒç”¨æˆ·å¯¹å„ç±»äº‹ä»¶ï¼ˆå¦‚åŠ å¯†è´§å¸ä»·æ ¼ã€ä½“è‚²èµ›äº‹ã€æ”¿æ²»äº‹ä»¶ç­‰ï¼‰è¿›è¡Œé¢„æµ‹äº¤æ˜“ã€‚

### æ ¸å¿ƒç‰¹æ€§
- é«˜æ€§èƒ½å†…å­˜æ’®åˆå¼•æ“ï¼ˆä»·æ ¼ä¼˜å…ˆã€æ—¶é—´ä¼˜å…ˆï¼‰
- æ”¯æŒé™ä»·å•å’Œå¸‚ä»·å•
- äº¤å‰æ’®åˆæœºåˆ¶ï¼ˆYes/No äºŒå…ƒæœŸæƒï¼‰
- å®æ—¶ WebSocket æ¨é€
- é“¾ä¸Šäº¤æ˜“ç»“ç®—
- å®Œå–„çš„èµ„äº§ç®¡ç†

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æœåŠ¡ç»„ä»¶ä¸€è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·å±‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ REST APIâ”‚  â”‚ WebSocketæ·±åº¦ â”‚  â”‚ WebSocketç”¨æˆ·              â”‚    â”‚
â”‚  â”‚ (api)   â”‚  â”‚(websocket_depth)â”‚ â”‚(websocket_user)           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â–¼               â–¼                        â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Redis Streams (æ¶ˆæ¯é˜Ÿåˆ—)                   â”‚   â”‚
â”‚  â”‚  order_input_stream | store_stream | processor_stream       â”‚   â”‚
â”‚  â”‚  websocket_stream   | cache_stream | onchain_stream         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                      â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚       â–¼                      â–¼                      â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Match    â”‚         â”‚ Store    â”‚          â”‚Processor â”‚          â”‚
â”‚  â”‚ Engine   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Service  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Service  â”‚          â”‚
â”‚  â”‚(æ’®åˆå¼•æ“)â”‚         â”‚(çŠ¶æ€æŒä¹…åŒ–)â”‚         â”‚(ç»“æœå¤„ç†)â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚                                          â”‚                 â”‚
â”‚       â–¼                                          â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Depth    â”‚  â”‚ Event    â”‚  â”‚ Asset    â”‚  â”‚OnchainMsg â”‚         â”‚
â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚ Service   â”‚         â”‚
â”‚  â”‚(æ·±åº¦èšåˆ)â”‚  â”‚(äº‹ä»¶ç®¡ç†)â”‚  â”‚(èµ„äº§ç®¡ç†)â”‚  â”‚(é“¾ä¸Šäº¤äº’) â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                              ä¸šåŠ¡å±‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              æ•°æ®å­˜å‚¨å±‚                   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  PostgreSQL  â”‚  â”‚      Redis       â”‚  â”‚
        â”‚  â”‚ (æŒä¹…åŒ–å­˜å‚¨)  â”‚  â”‚  (ç¼“å­˜/æ¶ˆæ¯é˜Ÿåˆ—) â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æœåŠ¡è¯¦è§£

### 1. Match Engineï¼ˆæ’®åˆå¼•æ“ï¼‰- æ ¸å¿ƒæœåŠ¡
**è·¯å¾„**: `match_engine/`

**åŠŸèƒ½**:
- æ¥æ”¶è®¢å•è¯·æ±‚ï¼Œæ‰§è¡Œå†…å­˜æ’®åˆ
- ç»´æŠ¤æ¯ä¸ª market/token çš„è®¢å•ç°¿ï¼ˆOrderBookï¼‰
- ä½¿ç”¨ BTreeMap å®ç°ä»·æ ¼ä¼˜å…ˆçº§æ’åº
- æ”¯æŒäº¤å‰æ’®åˆï¼ˆYes çš„ä¹°å•å¯ä»¥ä¸ No çš„ä¹°å•åŒ¹é…ï¼‰

**æ ¸å¿ƒæ•°æ®ç»“æ„**:
```rust
// è®¢å•ç°¿ç»“æ„
pub struct OrderBook {
    pub symbol: PredictionSymbol,       // å¸‚åœºæ ‡è¯†
    pub bids: BTreeMap<i32, Vec<Order>>, // ä¹°å•ï¼ˆè´Ÿä»·æ ¼keyå®ç°é™åºï¼‰
    pub asks: BTreeMap<i32, Vec<Order>>, // å–å•
    pub order_price_map: HashMap<String, (OrderSide, i32)>, // è®¢å•å¿«é€ŸæŸ¥æ‰¾
}
```

**æ’®åˆé€»è¾‘**:
- åŒç»“æœæ’®åˆï¼šBuy vs Sellï¼ˆä»·æ ¼åŒ¹é…ï¼‰
- äº¤å‰æ’®åˆï¼šBuy(Yes) vs Buy(No)ï¼Œprice_yes >= 10000 - price_no

### 2. Store Serviceï¼ˆçŠ¶æ€æŒä¹…åŒ–ï¼‰
**è·¯å¾„**: `store/`

**åŠŸèƒ½**:
- æ¶ˆè´¹æ’®åˆå¼•æ“çš„è®¢å•å˜åŒ–äº‹ä»¶
- ç»´æŠ¤å†…å­˜è®¢å•çŠ¶æ€
- å®šæœŸä¿å­˜å¿«ç…§åˆ° `./data/store/orders_snapshot.json`
- é‡å¯æ—¶ä»å¿«ç…§æ¢å¤

### 3. API Serviceï¼ˆREST APIï¼‰
**è·¯å¾„**: `api/`

**åŠŸèƒ½**:
- æä¾›ç”¨æˆ·é¢å‘çš„ REST API
- è®¢å•æäº¤/å–æ¶ˆ
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- å¸‚åœºæ•°æ®æŸ¥è¯¢

**ä¸»è¦ç«¯ç‚¹**:
| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/events` | GET | è·å–äº‹ä»¶åˆ—è¡¨ |
| `/event_detail` | GET | è·å–äº‹ä»¶è¯¦æƒ… |
| `/depth` | GET | è·å–å¸‚åœºæ·±åº¦ |
| `/place_order` | POST | ä¸‹å• |
| `/cancel_order` | POST | å–æ¶ˆè®¢å• |
| `/positions` | GET | è·å–æŒä»“ |
| `/open_orders` | GET | è·å–æœªæˆäº¤è®¢å• |

### 4. Asset Serviceï¼ˆèµ„äº§ç®¡ç†ï¼‰
**è·¯å¾„**: `asset/`

**åŠŸèƒ½**:
- ç®¡ç†ç”¨æˆ·èµ„äº§ï¼ˆUSDC å’Œ Tokenï¼‰
- å¤„ç†å……å€¼/æç°
- è®¢å•å†»ç»“/è§£å†»èµ„äº§
- Splitï¼ˆæ‹†åˆ† USDC ä¸º Tokenï¼‰
- Mergeï¼ˆåˆå¹¶ Token ä¸º USDCï¼‰
- Redeemï¼ˆèµå›è·èƒœ Tokenï¼‰

**gRPC æ¥å£**:
```protobuf
service AssetService {
  rpc Deposit(DepositRequest) returns (Response);
  rpc Withdraw(WithdrawRequest) returns (Response);
  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);
  rpc CancelOrder(CancelOrderRequest) returns (ResponseWithUpdateId);
  rpc Trade(TradeRequest) returns (TradeResponse);
  rpc Split(SplitRequest) returns (Response);
  rpc Merge(MergeRequest) returns (Response);
  rpc Redeem(RedeemRequest) returns (Response);
}
```

### 5. Processor Serviceï¼ˆç»“æœå¤„ç†ï¼‰
**è·¯å¾„**: `processor/`

**åŠŸèƒ½**:
- æ¶ˆè´¹æ’®åˆç»“æœ
- è°ƒç”¨ Asset Service æ›´æ–°èµ„äº§
- è½¬å‘åˆ°é“¾ä¸Šäº¤æ˜“æœåŠ¡
- æ¨é€åˆ° WebSocket æœåŠ¡

### 6. Depth Serviceï¼ˆæ·±åº¦èšåˆï¼‰
**è·¯å¾„**: `depth/`

**åŠŸèƒ½**:
- èšåˆè®¢å•ç°¿æ·±åº¦æ•°æ®
- è®¡ç®—ä»·æ ¼æ¡£ä½
- æ¨é€æ·±åº¦å˜åŒ–åˆ° WebSocket

### 7. Event Serviceï¼ˆäº‹ä»¶ç®¡ç†ï¼‰
**è·¯å¾„**: `event/`

**åŠŸèƒ½**:
- ç®¡ç†é¢„æµ‹å¸‚åœºäº‹ä»¶ç”Ÿå‘½å‘¨æœŸ
- åˆ›å»º/å…³é—­å¸‚åœº
- äº‹ä»¶ç»“ç®—

### 8. OnchainMsg Serviceï¼ˆé“¾ä¸Šäº¤äº’ï¼‰
**è·¯å¾„**: `onchain_msg/`

**åŠŸèƒ½**:
- å¤„ç†é“¾ä¸Šäº¤æ˜“è¯·æ±‚
- ç›‘å¬é“¾ä¸Šäº‹ä»¶ï¼ˆå……å€¼/æç°/Split/Merge/Redeemï¼‰
- ä¸æ™ºèƒ½åˆçº¦äº¤äº’

### 9. WebSocket Services
**è·¯å¾„**: `websocket_depth/`, `websocket_user/`

**websocket_depth** - å¸‚åœºæ·±åº¦æ¨é€:
```json
// è¿æ¥ç¡®è®¤
{"event_type": "connected", "id": "<uuid>"}
// è®¢é˜…
{"action": "subscribe", "event_id": 1, "market_id": 1}
```

**websocket_user** - ç”¨æˆ·æ•°æ®æ¨é€:
```json
// JWT è®¤è¯
{"auth": "<privy-jwt-token>"}
// è®¤è¯å“åº”
{"event_type": "auth", "success": true}
```

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### æ ¸å¿ƒç±»å‹

**Symbolï¼ˆå¸‚åœºæ ‡è¯†ï¼‰**:
```
æ ¼å¼: event_id|market_id|token_id
ç¤ºä¾‹: 1|1|0x123abc
```

**Orderï¼ˆè®¢å•ï¼‰**:
```rust
pub struct Order {
    pub order_id: String,
    pub symbol: PredictionSymbol,
    pub side: OrderSide,           // Buy/Sell
    pub order_type: OrderType,     // Limit/Market
    pub quantity: u64,             // æ•°é‡ Ã— 100
    pub price: i32,                // ä»·æ ¼ Ã— 10000 [100-9900]
    pub opposite_result_price: i32, // = 10000 - price
    pub status: OrderStatus,
    pub filled_quantity: u64,
    pub remaining_quantity: u64,
    pub timestamp: i64,
    pub user_id: i64,
    pub order_num: u64,            // æ—¶é—´ä¼˜å…ˆåºå·
}
```

**Price Range**:
- æœ‰æ•ˆä»·æ ¼èŒƒå›´: 0.0010 - 0.9990
- å†…éƒ¨è¡¨ç¤º: 10 - 9990ï¼ˆä¹˜ä»¥ 10000ï¼‰
- Yes + No ä»·æ ¼ = 1.0000ï¼ˆ10000ï¼‰

### æ•°æ®åº“è¡¨

| è¡¨å | è¯´æ˜ |
|------|------|
| `users` | ç”¨æˆ·ä¿¡æ¯ï¼ˆPrivy è®¤è¯ï¼‰ |
| `events` | é¢„æµ‹äº‹ä»¶ |
| `orders` | è®¢å•è®°å½• |
| `trades` | æˆäº¤è®°å½• |
| `positions` | ç”¨æˆ·æŒä»“ |
| `asset_history` | èµ„äº§å˜åŠ¨å†å² |
| `operation_history` | æ“ä½œå†å² |

---

## ğŸ”„ æ•°æ®æµ

### è®¢å•å¤„ç†æµç¨‹
```
1. ç”¨æˆ·ä¸‹å• â†’ API Service
2. API éªŒè¯ â†’ è°ƒç”¨ Asset Service (å†»ç»“èµ„äº§)
3. Asset Service æˆåŠŸ â†’ å‘é€åˆ° order_input_stream
4. Match Engine æ¶ˆè´¹ â†’ å†…å­˜æ’®åˆ
5. æ’®åˆç»“æœ â†’ å¤šè·¯è¾“å‡º:
   â”œâ”€â”€ store_stream â†’ Store Service (æŒä¹…åŒ–)
   â”œâ”€â”€ processor_stream â†’ Processor Service
   â”‚   â”œâ”€â”€ è°ƒç”¨ Asset Service (æ›´æ–°èµ„äº§)
   â”‚   â””â”€â”€ å‘é€åˆ° onchain_stream â†’ OnchainMsg Service
   â”œâ”€â”€ websocket_stream â†’ WebSocket Services
   â””â”€â”€ cache_stream â†’ Depth Service
```

### é“¾ä¸Šäº¤æ˜“æµç¨‹
```
1. Processor â†’ onchain_stream (å‘é€äº¤æ˜“è¯·æ±‚)
2. OnchainMsg â†’ æ„é€ é“¾ä¸Šäº¤æ˜“ â†’ å‘é€åˆ°åŒºå—é“¾
3. äº¤æ˜“ç¡®è®¤ â†’ onchain_response_stream
4. Processor æ¶ˆè´¹å“åº” â†’ è°ƒç”¨ Asset Service æœ€ç»ˆç¡®è®¤
```

---

## âš™ï¸ é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡ï¼ˆcommon.envï¼‰
```env
run_mode="dev"                        # è¿è¡Œæ¨¡å¼
engine_input_mq_redis_host="..."      # æ’®åˆå¼•æ“è¾“å…¥ Redis
engine_output_mq_redis_host="..."     # æ’®åˆå¼•æ“è¾“å‡º Redis
websocket_mq_redis_host="..."         # WebSocket Redis
postgres_read_host="..."              # PostgreSQL è¯»åº“
postgres_write_host="..."             # PostgreSQL å†™åº“
asset_rpc_url="..."                   # Asset Service gRPC
privy_pem_key="..."                   # Privy JWT éªŒè¯å…¬é’¥
```

### æœåŠ¡é…ç½®ï¼ˆdeploy/service/dev.tomlï¼‰
```toml
[logging]
level = "info"
file = "./logs/service.log"
console = true
rotation_max_files = 3

[engine_input_mq]
db = 0
batch_size = 100
```

---

## ğŸ”‘ å…³é”®è®¾è®¡å†³ç­–

### 1. ä»·æ ¼æ—¶é—´ä¼˜å…ˆæ’®åˆ
- BTreeMap å®ç°ä»·æ ¼æ’åº
- ä¹°å•ä½¿ç”¨è´Ÿä»·æ ¼ keyï¼ˆå®ç°é™åºï¼‰
- åŒä»·æ ¼æŒ‰æ—¶é—´æˆ³é¡ºåºï¼ˆFIFOï¼‰

### 2. äº¤å‰æ’®åˆæœºåˆ¶
é¢„æµ‹å¸‚åœºç‰¹æœ‰ï¼ŒYes å’Œ No äº’ä¸ºå¯¹æ‰‹ç›˜ï¼š
- Buy(Yes, 0.65) å¯åŒ¹é… Buy(No, 0.35)
- å› ä¸º: 0.65 + 0.35 = 1.00

### 3. æ—  WAL è®¾è®¡
- ä¾èµ– Redis Stream å¯é æ€§
- ä¼˜é›…åœæœºç¡®ä¿çŠ¶æ€ä¸€è‡´
- å¿«ç…§æ¢å¤æœºåˆ¶

### 4. å¹¶å‘å®‰å…¨
- `Arc<RwLock<T>>` å…±äº«çŠ¶æ€
- åŸºäº hash çš„ä»»åŠ¡è·¯ç”±
- åˆ†å¸ƒå¼é”å¤„ç†å¹¶å‘æ›´æ–°

### 5. æ¶ˆæ¯å»é‡
- SlidingWindowDedup æ»‘åŠ¨çª—å£å»é‡
- é˜²æ­¢é‡å¤è®¢å•å¤„ç†

---

## ğŸ› ï¸ å¼€å‘å‘½ä»¤

```bash
# æ„å»º
cargo build --release

# è¿è¡ŒæœåŠ¡
export RUN_MODE=dev
cargo run --bin match_engine
cargo run --bin store
cargo run --bin api
cargo run --bin asset
cargo run --bin processor
cargo run --bin depth
cargo run --bin onchain_msg
cargo run --bin websocket_depth
cargo run --bin websocket_user

# æµ‹è¯•
cargo test
cargo test -p match_engine

# ä»£ç è´¨é‡
cargo fmt
cargo clippy
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
PredictionMarket/
â”œâ”€â”€ api/                 # REST API æœåŠ¡
â”œâ”€â”€ asset/               # èµ„äº§ç®¡ç†æœåŠ¡
â”œâ”€â”€ common/              # å…¬å…±åº“ï¼ˆç±»å‹å®šä¹‰ã€å·¥å…·ï¼‰
â”œâ”€â”€ depth/               # æ·±åº¦èšåˆæœåŠ¡
â”œâ”€â”€ event/               # äº‹ä»¶ç®¡ç†æœåŠ¡
â”œâ”€â”€ match_engine/        # æ’®åˆå¼•æ“ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ onchain_msg/         # é“¾ä¸Šæ¶ˆæ¯æœåŠ¡
â”œâ”€â”€ processor/           # ç»“æœå¤„ç†æœåŠ¡
â”œâ”€â”€ proto/               # gRPC åè®®å®šä¹‰
â”œâ”€â”€ store/               # çŠ¶æ€æŒä¹…åŒ–æœåŠ¡
â”œâ”€â”€ websocket_depth/     # æ·±åº¦ WebSocket
â”œâ”€â”€ websocket_user/      # ç”¨æˆ· WebSocket
â”œâ”€â”€ deploy/              # éƒ¨ç½²é…ç½®
â”œâ”€â”€ script/              # è¿ç»´è„šæœ¬
â”œâ”€â”€ data/                # æ•°æ®æ–‡ä»¶
â””â”€â”€ logs/                # æ—¥å¿—æ–‡ä»¶
```

---

## ğŸ”— æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ |
|------|------|
| è¯­è¨€ | Rust |
| å¼‚æ­¥è¿è¡Œæ—¶ | Tokio |
| Web æ¡†æ¶ | Axum |
| RPC | Tonic (gRPC) |
| æ¶ˆæ¯é˜Ÿåˆ— | Redis Streams |
| æ•°æ®åº“ | PostgreSQL + SQLx |
| åºåˆ—åŒ– | Serde / JSON |
| è®¤è¯ | Privy JWT |
| æ—¥å¿— | Tracing |

---

## ğŸ“ˆ æ€§èƒ½è€ƒé‡

1. **å†…å­˜æ’®åˆ**: è®¢å•ç°¿å®Œå…¨åœ¨å†…å­˜ä¸­ï¼Œæ’®åˆå»¶è¿Ÿæä½
2. **æ¶ˆè´¹è€…ç»„**: Redis Streams æ”¯æŒå¤šæ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†
3. **å¿«ç…§æ¢å¤**: å®šæœŸå¿«ç…§ + å¢é‡æ¶ˆæ¯ï¼Œå¿«é€Ÿæ¢å¤
4. **è¯»å†™åˆ†ç¦»**: PostgreSQL æ”¯æŒè¯»å†™åˆ†ç¦»
5. **è¿æ¥æ± **: æ•°æ®åº“å’Œ Redis å‡ä½¿ç”¨è¿æ¥æ± 

---

## ğŸ¯ æ€»ç»“

è¿™æ˜¯ä¸€ä¸ªè®¾è®¡ç²¾è‰¯çš„é¢„æµ‹å¸‚åœºç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **é«˜æ€§èƒ½**: å†…å­˜æ’®åˆ + å¼‚æ­¥ IO
2. **é«˜å¯é **: æ¶ˆæ¯é˜Ÿåˆ— + å¿«ç…§æ¢å¤
3. **å¯æ‰©å±•**: å¾®æœåŠ¡æ¶æ„ + æœåŠ¡è§£è€¦
4. **å®‰å…¨æ€§**: JWT è®¤è¯ + é“¾ä¸Šç»“ç®—
5. **å®æ—¶æ€§**: WebSocket æ¨é€ + äº‹ä»¶é©±åŠ¨

ç³»ç»Ÿé€‚ç”¨äºé«˜é¢‘äº¤æ˜“åœºæ™¯ï¼Œèƒ½å¤Ÿå¤„ç†å¤§é‡å¹¶å‘è®¢å•ï¼ŒåŒæ—¶ä¿è¯æ•°æ®ä¸€è‡´æ€§å’Œå¯è¿½æº¯æ€§ã€‚
